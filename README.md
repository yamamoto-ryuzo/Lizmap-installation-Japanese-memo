# Difyã€€ã‚†ã‹ã‚Šã¡ã‚ƒã‚“
<<<<<<< HEAD
ã€€https://udify.app/chat/ROACB9bjRdLIVwZB  

# Lizmap
ã€€https://github.com/3liz/lizmap-web-client  
=======
ã€€https://udify.app/chat/ROACB9bjRdLIVwZB
# LIAMAP
ã€€https://github.com/3liz/lizmap-web-client
>>>>>>> 89abcd60d56147af34a07db992bdf6f0bd0a26a6
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ¡ãƒ¢
## 1.ä»®æƒ³ç’°å¢ƒã®è¨­å®š  
### 1-1.ã¾ãšã¯[WebARENA Indigo(Linux)](https://web.arena.ne.jp/indigo/)ï¼ˆä¾‹ï¼‰ã®ç”³ã—è¾¼ã¿  
---
ãƒ»ç”³ã—è¾¼ã¿ã§å£åº§ç¢ºèªã®ãŸã‚1000å††ãŒä¸€æ™‚çš„ã«è½ã¨ã•ã‚Œã¾ã™  
ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼Œè¬ã®220å††ãŒå¼•è½ã—ï¼Œå¤šåˆ†å£åº§ç¢ºèªï¼Ÿ  
![Alt text](image/image-2.png)  
2023-07-24
  https://docs.lizmap.com/current/en/install/linux.html#  
ã€€ã€€LIZMAP3.6ã«ã¯ã€€Ubuntu 20.04 LTSã€€ã¨ãªã£ã¦ã„ã‚‹ã€‚ 
2023-08-11  
ã€€ãŒã€22.04ã§å‹•ã„ã¦ã„ã‚‹ã‚µã‚¤ãƒˆã‚’ç¢ºèªã—ãŸã®ã§ã€22.04ã§ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼  

![image](https://user-images.githubusercontent.com/86514652/226173899-7b670847-9d6e-4630-bdfb-bed01243701a.png)

![Alt text](image/image-3.png)  
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯æœ€å®‰å€¤  
![image](https://user-images.githubusercontent.com/86514652/210161053-8b3f111e-2792-4f69-b6f1-992bacadcd78.png)  
SSHéµã®é¸æŠï¼ˆSSHéµä½œæˆã§ä½œæˆã—ã¦ãã ã•ã„ï¼ï¼‰  
![image](https://user-images.githubusercontent.com/86514652/210161063-182a007f-6446-45ff-9eb7-a3b8b4dc2e29.png)  
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å®Œæˆï¼ˆæ“ä½œï¼é¸æŠï¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é–‹å§‹ï¼‰  
![Alt text](image/image-4.png)  

### 1-2.VPSã¸ã®æ¥ç¶š  
---
ãƒ»SSHæ¥ç¶šã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ï¼ˆIndigoï¼‰  
SSHæ¥ç¶šã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ï¼ˆIndigoï¼‰  
SSHæ¥ç¶šç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆ(Tera Termç­‰)ã§ã€ä¸‹è¨˜ã‚’æŒ‡å®šã—ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«SSHæ¥ç¶šã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚  

ãƒ»ãƒ›ã‚¹ãƒˆåï¼šä½œæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹  
ãƒ»ãƒ¦ãƒ¼ã‚¶åï¼šcentos ã¾ãŸã¯ ubuntu  
ãƒ»ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºï¼šç©ºç™½  
ãƒ»ãƒãƒ¼ãƒˆï¼š22  
ãƒ»éµï¼šSSHéµã®ç§˜å¯†éµï¼ˆprivate_key.txt > identityï¼‰  
ãƒ»ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèªæ–¹æ³•ï¼š  
[ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç®¡ç†]â†’[ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹]ã«ç§»å‹•ã—ã€ä½œæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¬„ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚  
ãƒ»ãƒ¦ãƒ¼ã‚¶åï¼š  
CentOSã®å ´åˆã€centosã€€ã€€/ã€€ã€€**Ubuntuã®å ´åˆã€ubuntu**  
ãƒ»SSHæ¥ç¶šç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚½ãƒ•ãƒˆï¼šTera Termç­‰  
2023-08-11 Ubuntu 22.04 LTSã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«SSHæ¥ç¶š/ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã›ã‚“ã€€ã«æ³¨æ„ï¼  
https://help.arena.ne.jp/hc/ja/articles/5737789875223-Ubuntu-22-04-LTS%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%ABSSH%E6%8E%A5%E7%B6%9A-%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93-  

ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§rootæ¨©é™ã«æ˜‡æ ¼ã—ã¾ã™ã€‚  
sudo su -  
â€ƒ
ãƒ»èµ·å‹•ç”»é¢ã¯ã“ã‚“ãªæ„Ÿã˜  
![Alt text](image/image.png)

### 1-3.ã¨ã‚Šã‚ãˆãšæœ€æ–°ç‰ˆã¸  
---
sudo apt-get -y  update  
sudo apt-get -y  upgrade  
sudo apt -y dist-upgrade  
sudo apt-get -y install update-manager-core  
sudo do-release-upgrade  

ï¼ˆä»¥ä¸‹ï¼Œæ™‚æœŸã«ã‚ˆã£ã¦ãªã„ã‹ã‚‚ï¼ï¼‰  
é€”ä¸­ã§ã“ã‚“ãªã®èã„ã¦ã“ã‚‰ã‚ŒãŸã®ã§ã€ŒOKã€é¸ã‚“ã§ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼  
![image](https://user-images.githubusercontent.com/86514652/210162945-cd05b818-3fe5-4b67-8f6d-a7c91ccc808e.png)  
ã‚«ãƒ¼ãƒãƒ«æ–°ã—ã„ã®ã‚ã‚‹ã‚‰ã—ã„ã®ã§ã€ŒOKã€é¸ã‚“ã§ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼  
![image](https://user-images.githubusercontent.com/86514652/210162957-5c8cb00c-b4fb-4d52-b5c2-0a76701a9dc0.png) 
ãƒªãƒ–ãƒ¼ãƒˆã—ã‚ã¨è¨€ã£ã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ï¼Œã¨ã«ã‹ããƒªãƒ–ãƒ¼ãƒˆã—ã¦ï¼Œå†åº¦æœ€æ–°ç‰ˆã¸ãƒªãƒˆãƒ©ã‚¤ï¼  

ãã®ä»–ï¼Œã¨ã«ã‹ãã„ã‚ã„ã‚ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ãƒ»ãƒ»ãƒ»  

### 1-4.Ubuntuã®ç’°å¢ƒè¨­å®šï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå«ã‚€ï¼‰  
---
sudo su  
sudo apt -y autoremove  
sudo apt -y install language-pack-ja-base language-pack-ja  
sudo apt -y install fonts-takao  
sudo apt -y install fonts-ipafont fonts-ipaexfont  
sudo apt -y install ttf-mscorefonts-installer  
dpkg-reconfigure locales  
dpkg-reconfigure tzdata  
sudo apt -y install ntp ntpdate  

ã€€dpkg-reconfigure localesã€€ä¸‹è¨˜ç¢ºèªï¼Œé¸æŠã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™  
ã€€1.ja_JP.UTF-8ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèª  
 ![image003](https://user-images.githubusercontent.com/86514652/174401559-eca104fa-ef58-4a15-b240-f1d4af6b8046.png)
 
ã€€2.ja_JP.UTF-8ã€€ã‚’é¸æŠ  
 ![image004](https://user-images.githubusercontent.com/86514652/174401570-49f16fd3-864d-476f-a4e5-88eabc228079.png)
â€ƒ
### 1-5.æ¯æ—¥ä¸‘ä¸‰ã¤æ™‚ã€åˆå‰2æ™‚ã«å†èµ·å‹•ã®è¨­å®š  
---
sudo su  
crontab -e  

ã™ã‚‹ã¨ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãªã«ä½¿ã†ï¼Ÿã¨èã„ã¦ãã‚‹ã®ã§ã‚³ãƒªãŒãªã„é™ã‚Šï¼Œnanoã€€ã®ã€€ã€Œ1ã€ã€€ã‚’é¸æŠ  
![image](https://user-images.githubusercontent.com/86514652/210163278-5d2ae67c-f5da-4d6f-afe5-e2ac214c6553.png)  

0 2 * * * /sbin/shutdown -r now  
 ![image005](https://user-images.githubusercontent.com/86514652/174401620-4af86ebe-c8f4-43f6-a4ed-218cc7fc1d26.png)

ã‚³ãƒãƒ³ãƒ‰ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œ#ã‚’æ”¹è¡Œã—ã¦ã‚ã’ã¦ç¶ºéº—ã«ï¼  
ã‚ã¨ã¯ï¼Œã‚¨ãƒ‡ã‚£ã‚¿ã‚’ã€€Ctrl+Xã€€ã§çµ‚äº†ã—  
Yã‚’é¸æŠã—  
Enterã€€ã‚’æŠ¼ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã—ã¦çµ‚äº†  

### 1-6.ãƒ­ã‚°ç®¡ç†ãŒé¢å€’ãªäººå‘ã‘
---
å®šæœŸçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—  
cronã‚¸ãƒ§ãƒ–ã‚’è¨­å®šã—ã¦ã€å¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®šæœŸçš„ã«å‰Šé™¤ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:  
bash  
sudo crontab -e  
ä»¥ä¸‹ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™:  
text  
0 0 * * * find /var/log -type f -mtime +30 -delete  
ã“ã‚Œã«ã‚ˆã‚Šã€30æ—¥ä»¥ä¸ŠçµŒéã—ãŸãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ¯æ—¥å‰Šé™¤ã•ã‚Œã¾ã™ã€‚  
ã“ã‚Œã‚‰ã®æ–¹æ³•ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€/var/logã®å®¹é‡ã‚’åŠ¹æœçš„ã«åˆ¶é™ã§ãã¾ã™ã€‚ãŸã ã—ã€é‡è¦ãªãƒ­ã‚°ãŒå¤±ã‚ã‚Œãªã„ã‚ˆã†æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚  

## 2.WEBç’°å¢ƒã®æ§‹ç¯‰  Apache

---
### 2-1.Apacheã€€ã‚µãƒ¼ãƒãƒ¼ã®æ§‹ç¯‰  
#### ï¼ˆstep0ï¼‰æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ãŸã„ã¨ã  

sudo apt -y purge apache2 libapache2-mod-fcgid  
sudo apt -y purge php-* php8.2-* libapache2-mod-php8.2  
sudo apt -y autoremove  

#### ï¼ˆstep1ï¼‰fcgidã®è¨­å®š   
sudo su  
sudo apt -y update  
sudo apt -y upgrade  
sudo apt -y install apache2 libapache2-mod-fcgid  
sudo ufw app list  
![image](https://user-images.githubusercontent.com/86514652/221405257-3878eb66-b1e5-46ae-800a-98a562d6a054.png)
 
##### ï¼ˆstep2ï¼‰
**2023-08-12**  
ã€€Ubuntu22.04+Lizmap3.6ã«ãŠã„ã¦PHP7.4ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãŒã©ã†ã‚‚ç‰©è¶³ã‚Šã‚“ã®ã¨æ€’ã‚‰ã‚ŒãŸ  
ã€€æ¨™æº–ã®PHP8.0ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨æº€è¶³ã—ã¦ãã‚ŒãŸã¿ãŸã„ã ï¼  
 
sudo apt -y update  
sudo apt -y upgrade  

#2023-08-12 å®Ÿéš›ã«ã¯Error 500ã¨ãªã‚‹ã®ã§PHP8ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
#2023-08-12 æ™‚ç‚¹ã§ã¯PHP8.0ãªã®ã§ãã®å‰æã§èª¬æ˜  

sudo apt install -y php  

#PHP7.4
sudo apt -y install php7.4-fpm php7.4-cli php7.4-bz2 php7.4-curl php7.4-gd php7.4-intl php7.4-json php7.4-mbstring php7.4-pgsql php7.4-sqlite3 php7.4-xml php7.4-ldap php7.4-redis
sudo apt-get install libapache2-mod-php7.4  

#PHP8.0
sudo apt -y install php8.0-fpm php8.0-cli php8.0-bz2 php8.0-curl php8.0-gd php8.0-intl php8.0-mbstring php8.0-pgsql php8.0-sqlite3 php8.0-xml php8.0-ldap php8.0-redis  
#php8.0-json ã‚’æ˜ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†  
sudo apt-get install libapache2-mod-php8.0  

---
### 2-2.Webminã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
ï¼ˆstep1ï¼‰  
sudo apt -y update  
sudo apt -y upgrade  
sudo nano /etc/apt/sources.list  

ï¼ˆstep2ï¼‰  
ä¸‹è¨˜ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ   
deb http://download.webmin.com/download/repository sarge contrib  

ï¼ˆstep3ï¼‰  
wget -q -O- http://www.webmin.com/jcameron-key.asc | sudo apt-key add  
sudo apt -y update  
sudo apt -y install webmin  

ï¼ˆstep4ï¼‰ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’è¨­å®š  
sudo ufw allow 10000  

---
### 2-3.Webminã‚’åˆ©ç”¨  

https:// server-ip:10000/  
ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨å®‰å…¨ã§ã¯ãªã„ã¨ã„ã‚ã‚Œã‚‹ãŒç„¡è¦–ï¼ã—ã¦æ¥ç¶šã™ã‚‹ã€‚  
 ![image006](https://user-images.githubusercontent.com/86514652/174401813-5b4ad211-2ab1-4c3e-8561-def64ac9dc9e.png)


ãã‚‚ãã‚‚rootãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã—ãŸè¨˜æ†¶ãŒãªã„ãƒ»ãƒ»ãƒ»  

sudo su  
passwd  

ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šï¼Œã¡ãªã¿ã«ç”»é¢è¡¨ç¤ºãŒãªã„ãŒï¼Œå…¥åŠ›ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã®ã§æ°—ã«ã›ãšï¼’å›å…¥åŠ›ã™ã‚‹ã€‚  
Username:rootã€€ã€€Passwordï¼šè¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰  
![image](https://user-images.githubusercontent.com/86514652/210163944-832dad2b-dc91-449b-8b4e-53a6b2b1e5ea.png)  


ã“ã“ã¾ã§ãã‚Œã°ã‚ã¨ã¯ç°¡å˜ï¼  
ä¸€å¿œæ—¥æœ¬èªåŒ–ã¾ã§ã‚’èª¬æ˜  
ãƒ»ã€ŒChange Language and Themeã€ã‚’ã‚¯ãƒªãƒƒã‚¯  
 ![image007](https://user-images.githubusercontent.com/86514652/174401866-f894dd5f-7a7e-4603-aeaa-8b341c0fa5b2.png)

ãƒ»ã€ŒWebminConfigurationã€ï¼ã€Œlanguage and Localeã€ã§ã€Œæ—¥æœ¬èªã€ã‚’é¸æŠ  
![image](https://user-images.githubusercontent.com/86514652/226108222-50923361-34db-454a-bf4f-aab8828569cd.png)  

ãƒ»ã€Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã€ï¼ã€Œã‚·ã‚¹ãƒ†ãƒ æ™‚é–“ã€ã§ã€Œã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’å¤‰æ›´ã€ã‚’é¸æŠ  
ã‚·ã‚¹ãƒ†ãƒ æ™‚é–“ã‚’ã€€ã€ŒAsia/Tokyoã€ã«ãªã£ã¦ã„ã‚‹ã‹ã¯å†åº¦ç¢ºèªã€‚  
ãªã£ã¦ã„ãªã„ã¨ï¼ŒãŠã‚„ï½ï½ã¨æ€ã†ã“ã¨ãŒç™ºç”Ÿã—ã¾ã™ã€‚  

 ![image009](https://user-images.githubusercontent.com/86514652/174401933-8c65d0f4-552d-4329-835b-71c0f68d8162.png)  

---
### 2-4.ProFTPDã®è¨­å®š  

Webminã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
ã€€æœªä½¿ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€€ï¼ã€€ProFTPDã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€InstallNowã€€ã€€ï¼ã€€InstallNow  

ã€€ ![image010](https://user-images.githubusercontent.com/86514652/174402087-56c59192-f77b-4e48-a2f0-fb2fadd5e23c.png)


ã€€ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€ProFTPDã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€å„ç¨®è¨­å®šãŒå¯èƒ½ã¨ãªã£ã¦ã„ã‚‹  
 ![image011](https://user-images.githubusercontent.com/86514652/174402121-77a4c827-d239-46cd-92c9-3372b14e35f9.png)

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä»»æ„ã«è¨­å®š  
ä»Šå›ã¯  /varwww/  
![Alt text](image/image028.png)

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ  
ã€€ã‚·ã‚¹ãƒ†ãƒ ã€€ï¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŠã‚ˆã³ã‚°ãƒ«ãƒ¼ãƒ—  
ã€€æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã€€ï¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ã€Œlizmapcloudã€ã¨å…¥åŠ›  
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€Œ/var/www/lizmap/lizmapcloudã€  
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€Œä»»æ„ã«å…¥åŠ›ã€  
æ‰€å±ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—-æ—¢å­˜ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã€Œwww-dataã€ã‚’é¸æŠ  
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï¼ä½œæˆ  


## 3.QGISã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š  
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æœ¬æ ¼çš„ãªè©³ç´°ã¯  
https://docs.qgis.org/3.22/pdf/ja/QGIS-3.22-ServerUserGuide-ja.pdf  
https://docs.qgis.org/3.22/ja/docs/training_manual/qgis_server/install.html  

### 3-1.QGISã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
---
ä»Šå›ã®QGISserverã¯3.28ã ã£ãŸã®ã§ã€  
https://docs.qgis.org/3.28/ja/docs/training_manual/qgis_server/install.html  
ã€Œ11.1. Lesson: QGISã‚µãƒ¼ãƒãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€ã«ã‚ˆã‚Šå®Ÿæ–½  

#æœ€æ–°ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’è¨­å®š  
#ã“ã‚Œã§python3-qgisã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ã«ãªã‚‹  
sudo apt install gnupg software-properties-common  
sudo wget -O /etc/apt/keyrings/qgis-archive-keyring.gpg https://download.qgis.org/downloads/qgis-archive-keyring.gpg  

nano /etc/apt/sources.list.d/qgis.sources  

#Example for the latest long term release for Ubuntu 22.04 Jammy:  
#ä»¥ä¸‹ã‚’è¨˜å…¥  
Types: deb deb-src  
URIs: https://qgis.org/ubuntu-ltr  
Suites: jammy  
Architectures: amd64  
Components: main  
Signed-By: /etc/apt/keyrings/qgis-archive-keyring.gpg  
#ã“ã“ã¾ã§  

#å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã¾ãšå¤ã„ç’°å¢ƒã‚’å‰Šé™¤  
sudo apt -y purge qgis-server  
sudo apt autoremove  

#é€šå¸¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
sudo su  
sudo apt -y upgrade  
sudo apt -y update  
sudo apt -y install qgis-server --no-install-recommends --no-install-suggests  
sudo  apt -y install python3-qgis  
#å¿…è¦ãªã‚‰ä¸‹è¨˜ã‚’å®Ÿè¡Œ  
sudo apt --fix-broken install  
#æœ€å¾Œã¯ãŠæƒé™¤  
sudo apt -y autoremove  

### 3-2.QGISã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‹•ä½œç¢ºèª  
---
#ã¨ã‚Šã‚ãˆãšã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ã¿ã‚‹  
/usr/lib/cgi-bin/qgis_mapserv.fcgi --version  
![Alt text](./image/image030.png)  

#ã“ã®åå¿œã‹ã‚‰ã—ã¦QGISã‚µãƒ¼ãƒãƒ¼ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¦ã„ã‚‹ã®ã¯æ˜ç™½ï¼  
#å‹•ã‹ãªã„ã®ã¯è¨­å®šãŒãŠã‹ã—ã„ã‹ã‚‰ï¼ï¼Ÿ  
#åŸºæœ¬çš„ãªå‹•ä½œãƒ†ã‚¹ãƒˆã‚’è¡Œã£ã¦ã¿ã‚‹  
curl http://127.0.0.1/cgi-bin/qgis_mapserv.fcgi  
![Alt text](./image/image031.png)  
#ç°¡å˜ã«è¨€ã†ã¨å‹•ã„ã¦ã„ãªã„ã€‚
#apacheã®è¨­å®šãŒæ‚ªã„ã‚ˆã†ã ï¼


### 3-3.[QGIS-Plugin-Manager](https://docs.lizmap.com/current/en/install/pre_requirements.html#qgis-server-plugins)ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
---
è©³ç´°ã¯ https://pypi.org/project/qgis-plugin-manager/  
ã¾ãŸã¯ https://github.com/3liz/qgis-plugin-manager  

##### pthon3.7ä»¥ä¸ŠãŒå¿…è¦ãªã®ã§å¿…ãšãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€‚  
sudo su  
python3 --version  
pip3 install qgis-plugin-manager  
python3 -m pip install qgis-plugin-manager  

#qgis-pluginå„ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆ  
#apache2ã®è¨­å®š lizmap-fcgi.conf ã‚’è¨­å®š  
#FcgidInitialEnv QGIS_PLUGINPATH /usr/lib/qgis/plugins

#For security reason, to enable the API on the QGIS server side, you must enable the environment variable  
#Apache FCGI example  
#FcgidInitialEnv QGIS_SERVER_LIZMAP_REVEAL_SETTINGS True  

sudo su  
cd /usr/lib/qgis/plugins  
qgis-plugin-manager update  
qgis-plugin-manager upgrade  
qgis-plugin-manager init  
qgis-plugin-manager install 'Lizmap server'  
qgis-plugin-manager install wfsOutputExtension  
qgis-plugin-manager install atlasprint  
qgis-plugin-manager install 'Data Plotly'  

qgis-plugin-manager upgrade  

### 3-4.QGIS-Plugin-Managerã®å‹•ä½œç¢ºèª  
---
#ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ³ã®ç¢ºèª  
qgis-plugin-manager list  
![Alt text](image/image029.png)  

### 3-5. [QGIS-Plugin-Managerã®è¨­å®š](https://docs.qgis.org/3.22/ja/docs/server_manual/plugins.html)  
---
ã¨ã‚Šã‚ãˆãšã‚µãƒ¼ãƒãƒ¼ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã¯ã“ã‚“ãªæ„Ÿã˜ï¼Ÿ  
ã€ŒUnknownã€ã£ã¦è¨€ã‚ã‚Œã‚‹ï¼
![image](https://user-images.githubusercontent.com/86514652/210211621-0a41e5d4-43f1-4815-a3b4-00a7f7ef146a.png)

### 3-6.QGISã‚µãƒ¼ãƒãƒ¼ã®ãƒ†ã‚¹ãƒˆ 
---
systemctl restart apache2  
/usr/lib/cgi-bin/qgis_mapserv.fcgi  
ã€€ã‚’å®Ÿè¡Œï¼  
ã€€æ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚‹ã‚‰ã—ã„ï¼
![image](https://user-images.githubusercontent.com/86514652/221395008-e19b8868-cdbd-4fd2-aecf-4c48b07ec17f.png)  
ã€€è©³ç´°ã¯ä¸‹è¨˜ã‚’å‚ç…§  
https://docs.qgis.org/3.22/ja/docs/server_manual/getting_started.html#installation-on-debian-based-systems  

ã€€ç§ã®å ´åˆã¯ã“ã‚“ãªæ„Ÿã˜ï¼é›°å›²æ°—å‹•ã„ã¦ã„ã‚‹ã£ã½ã„ãŒã€å¾…ã¡ã«å¾…ã£ãŸ3.22ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã£ã¦ã„ã‚‹ï¼Ubuntu22.04ã§æ­£è§£ï¼å¿ƒé…ãªã®ã¯302ãƒ»ãƒ»ãƒ»ãã®ã†ã¡ã‚ã‹ã‚‹ã ã‚ã†ï¼  
![Alt text](image/image2.png)

### 3-7.QGISã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š 
---  
Lizmap3.6ä»¥ä¸Šã¯å¿…ãšè¨­å®šãŒå¿…è¦ï¼  
ã—ã‹ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨é•ã†è¨­å®šãªã®ã§ã€ä¿®æ­£ãŒå¿…è¦ã€‚  
wmsServerURL="http://ãƒ»ãƒ»ãƒ»ãƒ»"  
![Alt text](/image/image033.png)  

### QGISã®è¨­å®š ###  
#### ãƒ»Make sure correct environment variables are set in your web server configuration ####  
#### ãƒ»for example in Apache2 with mod_fcgid ####  
nano /etc/apache2/mods-available/fcgid.conf  
FcgidInitialEnv QGIS_PLUGINPATH "/srv/qgis/plugins/"  
#### ãƒ»Reload server, for example with Apache2 ####  
service apache2 reload  

##### 3-1-3.QGISã®ãƒ­ã‚°ã¨èªè¨¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ ¼ç´ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ  
mkdir -p /var/log/qgis/  
chown www-data:www-data /var/log/qgis  
mkdir -p /home/qgis/qgisserverdb  
chown www-data:www-data /home/qgis/qgisserverdb  
systemctl restart apache2  

## 4.PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ§‹ç¯‰  
### 4-1.PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
Webminã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
ã€€æœªä½¿ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€€ï¼ã€€PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼  
ã€€ï¼ã€€InstallNowã€€ã€€ï¼ã€€InstallNow  
### 4-2.postgresã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š  
Webminã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  

ã€€ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€PostgreSQLãƒ¦ãƒ¼ã‚¶ãƒ¼  
ã€€ï¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼špostgresã‚’é¸æŠã€€ï¼ã€€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã€€ï¼ã€€ä¿å­˜  
### 4-3.lizmapè¿½åŠ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¨­å®š  
Webminã‚ˆã‚Šè¨­å®š  

ã€€ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€PostgreSQLãƒ¦ãƒ¼ã‚¶ãƒ¼  
ã€€ã€€ã€€ã€€ã€€ã€€ï¼ã€€æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ  
ã€€ï¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼šlizmapï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆã‚’å¯èƒ½ã‚’é¸æŠ  

 ![image013](https://user-images.githubusercontent.com/86514652/174402386-07d92c7a-2862-4c68-9e72-e52c793147db.png)

â€ƒ![image014](https://user-images.githubusercontent.com/86514652/174402420-495a3589-f06d-4c96-bbfa-35e9acbf1cbd.png)

#### 4-4.Lizmapãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ  
Webminã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
ã€€ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€æ–°è¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ  
ã€€ã€€ã€€ã€€ã€€ã€€ï¼ã€€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åï¼Œã‚ªãƒ¼ãƒŠãƒ¼ï¼šLizmapã€€ï¼ã€€ä½œæˆ  
 ![image015](https://user-images.githubusercontent.com/86514652/174402454-3fb0cb71-bca5-4680-8188-436b8c759552.png)  

 
### 4-5.è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†  
##### UBUNTU	/etc/postgresql/VERSION/main/postgresql.conf ã®ä¿®æ­£  
ã€€ä»Šå›ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯14.8ã ã£ãŸã®ã§ã€€14ã€€ã§å…¥åŠ›  
nano /etc/postgresql/14/main/postgresql.conf  

ã€€ã«ã€€listen_addresses = '*'ã€€ã‚’è¿½åŠ   
 ã€€å¤–éƒ¨æ¥ç¶šã‚’ã—ãªã„å ´åˆã¯'localhost'  
ã€€ã€€ã€€max_connections = 1000ã€€ã«ä¿®æ­£  
![image](https://user-images.githubusercontent.com/86514652/210170140-b7011381-2ce2-4c81-8c76-8be51a7abc65.png)  

##### UBUNTU	/etc/postgresql/VERSION/main/pg_hba.confã€€ã‚’ä¸‹è¨˜ã«æ›¸ãæ›ãˆ  
ã€€ä»Šå›ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯14.8ã ã£ãŸã®ã§ã€€14ã€€ã§å…¥åŠ›  
nano /etc/postgresql/14/main/pg_hba.conf  

local	all all 							trust  
host	all all 127.0.0.1	255.255.255.255	md5  
host	all all 0.0.0.0/0					md5  
host	all all ::1/128						md5  
hostssl all all 127.0.0.1	255.255.255.255	md5  
hostssl all all 0.0.0.0/0					md5  
hostssl all all ::1/128						md5  

### 4-6.ç©ºã‹ã‚‰ã®LIZMAPç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ
#### PostGISç­‰æ‹¡å¼µæ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ã¨åˆæœŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ç¢ºèª  
Webminã‚ˆã‚Šç©ºã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€Œlizmapã€ã‚’ä½œæˆ  
ã€€ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã€€ï¼ã€€æ–°è¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ  
![Alt text](image/image3.png)  

[pgAdmin](https://www.pgadmin.org/)ã‚ˆã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
ã€€ä»Šå›ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯14.8ã ã£ãŸã®ã§ã€€14ã€€ã§å…¥åŠ›  
ã€€sudo apt -y install postgis postgresql-VERSION-postgis-3  

sudo apt -y update  
sudo apt -y install postgis postgresql-14-postgis-3  

ã€€**ãƒ­ã‚°ã‚¤ãƒ³ã¯ã€€postgresï¼šã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§è¡Œã†å¿…è¦ã‚ã‚Š**  
ã€€æ‹¡å¼µã€€ã‚’ã€€å³ã‚¯ãƒªãƒƒã‚¯ã€€ï¼ã€€ä½œæˆã€€ï¼ã€€æ‹¡å¼µã€€ï¼ã€Œpostgisã€ã‚’é¸æŠã€€ï¼ä¿å­˜  
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï¼ã€Œpg_trgmã€ã‚’é¸æŠã€€ï¼ä¿å­˜  
  ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ï¼ã€Œunaccentã€ã‚’é¸æŠã€€ï¼ä¿å­˜  
ã€Œpg_trgmã€ã€Œunaccentã€ã¯Lizmapã®æ¤œç´¢æ©Ÿèƒ½ã§å¿…è¦ã§ã™ã€‚  

![image017](https://user-images.githubusercontent.com/86514652/174402540-0143fc31-e084-4edc-ae6b-be757b00ba1c.png)  

## 5.Lizmap Web Clientã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå«ã‚€ï¼‰
### 5-1.Lizmap Web Clientã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
ã€€ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ http://localhost/lizmap/ ã«è¨­å®šã™ã‚‹  
ã€€ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 3liz/lizmap-web-client: Transfer a QGIS project on a server, Lizmap is providing the web interface to browse it (github.com) ã§ç¢ºèªã€‚  

#### step-1  
---
https://github.com/3liz/lizmap-web-client/releases  
ã§æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª  

##### (step1-VERSION=3.9.0-rc.3)  
sudo su  
cd /var/www/ 
#VERSION=3.8.1   
VERSION=3.8.10   
#VERSION=3.9.0-rc.3  
#ä½•ã‹ã®é–“é•ã„ã§æ—¢å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã‚ã‚‹å ´åˆã¯å¼·åˆ¶å‰Šé™¤  
rm -rf /var/www/lizmap-web-client-$VERSION  

#æœ€æ–°ç‰ˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰  
wget https://github.com/3liz/lizmap-web-client/releases/download/$VERSION/lizmap-web-client-$VERSION.zip  

#-o	ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªãªã—ã«ä¸Šæ›¸ãè§£å‡ã™ã‚‹  
unzip -o lizmap-web-client-$VERSION.zip  
#### Lizmapæœ¬ä½“å‚ç…§ã®ãŸã‚ã®ã‚·ãƒ³ãƒãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã€€ã®ä½œæˆ  
rm /var/www/html/lizmap  
ln -s /var/www/lizmap-web-client-$VERSION/lizmap/www/ /var/www/html/lizmap  

rm lizmap-web-client-$VERSION.zip  
chown -R www-data:www-data /var/www/lizmap-web-client-$VERSION  

### step-2  
cd /var/www/lizmap-web-client-$VERSION/  
cd lizmap/var/config  
cp lizmapConfig.ini.php.dist lizmapConfig.ini.php  
cp localconfig.ini.php.dist localconfig.ini.php  
cp profiles.ini.php.dist profiles.ini.php  
cd ../../..  
#PHP ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã‚“ã ã‚Šã€å¤‰æ›´ã‚’åŠ ãˆãŸã‚Šã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  
lizmap/install/set_rights.sh www-data www-data  

### step-3  
### step3-åˆã‚ã¦ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆ  
#ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸Mediaãƒ•ã‚©ãƒ«ãƒ€å‚ç…§ã®ãŸã‚ã®ã‚·ãƒ³ãƒãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã€€ã®ä½œæˆ  
ln -s /var/www/lizmap/ /var/www/lizmap-web-client-$VERSION/lizmap/www/lizmap_symlink  

#Postgresqlãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒ‡å®š  
nano /var/www/lizmap-web-client-$VERSION/lizmap/var/config/profiles.ini.php  
#####ã€€ä¸‹è¨˜é …ç›®ã‚’ç½®ãæ›ãˆ  

[jdb:jauth]  
driver=pgsql  
host=localhost  
port=5432  
database="lizmap"  
user=postgres  
password=***  
search_path=public  

[jdb:lizlog]  
driver=pgsql  
host=localhost  
port=5432  
database="lizmap"  
user=postgres  
password=***  
search_path=public  

#ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®èµ·å‹•  
#ver3.6ã‹ã‚‰ã¯php lizmap/install/configurator.phpã‚‚è¿½åŠ   
php /var/www/lizmap-web-client-$VERSION/lizmap/install/configurator.php  

![Alt text](../image/image026.png)  
#ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯postgresã®åˆæœŸè¨­å®šå«ã‚€  
#lizmapãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã„ã‚ã„ã‚è¿½åŠ ã•ã‚Œã¦ã„ã‚‹  
php /var/www/lizmap-web-client-$VERSION/lizmap/install/installer.php  

![Alt text](../image/image025.png)  

###  step3-ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®å ´åˆ  
#ã„ã‚ã„ã‚ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãŠã
sudo apt update  
sudo apt upgrade  
sudo apt full-upgrade   
sudo apt autoremove  

#PHPã®ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã‚’ç¢ºèª
#ä»Šå›ã¯PHP8.2ã¸
#ç¾åœ¨ã®PHPãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
php -v  
sudo add-apt-repository ppa:ondrej/php -y  
sudo apt update  
sudo su  
#PHPã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
#purgeã§è¨­å®šã‚‚å«ã‚ã¦å‰Šé™¤  
sudo apt-get -y purge 'php*'  
sudo apt -y autoremove  
#PHPã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
sudo apt -y install php8.2-fpm php8.2-cli php8.2-bz2 php8.2-curl php8.2-gd php8.2-intl php8.2-mbstring php8.2-pgsql php8.2-sqlite3 php8.2-xml php8.2-ldap php8.2-redis  
#php8.2-json ã‚’æ˜ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†  
sudo apt-get install libapache2-mod-php8.2 
#ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®PHPã‚’é¸æŠ  
sudo update-alternatives --config php  
php -v  

#ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç­‰ã‚‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãŠã
sudo su  
cd /usr/lib/qgis/plugins  
qgis-plugin-manager update  
qgis-plugin-manager upgrade  

sudo service apache2 restart 
#ã„ã‚ã„ã‚æ›´æ–°ãŒã‚ã£ãŸã‚‰å†èµ·å‹•ãŒç„¡é›£ï¼
sudo reboot  

#è¨­å®šã‚’å¼•ãç¶™ããƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨˜å…¥ãã ã•ã„ã€‚  
#å„è‡ªå¤‰æ›´ã—ã¦ãã ã•ã„  
#ãã®å ´åˆã€ç¶šãã¯æœ€åˆã«æˆ»ã‚‹  
old_VERSION=3.8.1  
    
#ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸Mediaãƒ•ã‚©ãƒ«ãƒ€å‚ç…§ã®ãŸã‚ã®ã‚·ãƒ³ãƒãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã€€ã®ä½œæˆ  
ln -s /var/www/lizmap/ /var/www/lizmap-web-client-$VERSION/lizmap/www/lizmap_symlink  
  
#var/config/liveconfig.ini.phpã€€ã¯æ›´æ–°ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚ãªãœãªã‚‰ï¼Œapp/system/mainconfig.ini.php ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚“ã§ãŠã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è‡ªä½“ã«ã‚ˆã£ã¦å¤‰æ›´ã•ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚  
  
cp -f /var/www/lizmap-web-client-$old_VERSION/lizmap/var/config/profiles.ini.php /var/www/lizmap-web-client-$VERSION/lizmap/var/config/profiles.ini.php  
cp -f /var/www/lizmap-web-client-$old_VERSION/lizmap/var/config/lizmapConfig.ini.php  /var/www/lizmap-web-client-$VERSION/lizmap/var/config/lizmapConfig.ini.php  
cp -f /var/www/lizmap-web-client-$old_VERSION/lizmap/var/config/localconfig.ini.php  /var/www/lizmap-web-client-$VERSION/lizmap/var/config/localconfig.ini.php  
  
#åˆæœŸ/Landingãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€€ã®ã‚³ãƒ”ãƒ¼  
cp -f -r /var/www/lizmap-web-client-$old_VERSION/lizmap/var/lizmap-theme-config/ /var/www/lizmap-web-client-$VERSION/lizmap/var/  

#ã‚¢ãƒ‘ãƒƒãƒã‚’å†èµ·å‹•ã—ã¦çµ‚äº†ã§ã™!  
#ã©ã†ã ç¢ºèªã€å‹•ã„ã¦ã„ã‚Œã°OK  
#ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®å ´åˆã¯ã“ã“ã§çµ‚äº†ã€ãŒç¾å®Ÿã«ã¯ã„ã¤ã‚‚ãªã«ã‹ãƒˆãƒ©ãƒ–ãƒ«ã‚ã‚Šï¼ğŸ’¦  
sudo service apache2 restart  

####  ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ™‚ã®ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼
##### ã‚¨ãƒ©ãƒ¼å†…å®¹
Error 500. A technical error has occured. Sorry for this trouble.
The application is not installed
##### lizmap-web-clientã€€å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
cd /var/www/lizmap-web-client-$VERSION/  
php lizmap/install/configurator.php  
php lizmap/install/installer.php  
sudo service apache2 restart 

#### py-qgis-serverã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« 
#Python venv ã«py-qgis-serverã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
#https://docs.lizmap.com/current/ja/install/py-qgis-server.htmlã€€å‚ç…§
apt install python3-venv python3-psutil  
set -e  
python3 -m venv /opt/local/py-qgis-server --system-site-packages  
/opt/local/py-qgis-server/bin/pip install -U pip setuptools wheel pysocks typing py-qgis-server  

#è¨­å®šã¨é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
mkdir -p /srv/qgis/plugins /srv/qgis/config /srv/data /var/log/qgis /var/lib/py-qgis-server  
touch /var/lib/py-qgis-server/py-qgis-restartmon  
chmod 664 /var/lib/py-qgis-server/py-qgis-restartmon  
touch /var/lib/py-qgis-server/py-qgis-restartmon  
nano /srv/qgis/server.conf
```
#
# Py-QGIS-Server configuration
# https://docs.3liz.org/py-qgis-server/
#

[server]
port = 7200
interfaces = 127.0.0.1
workers = 4
pluginpath = /srv/qgis/plugins
timeout = 200
restartmon = /var/lib/py-qgis-server/py-qgis-restartmon

[logging]
level = info

[projects.cache]
strict_check = false
rootdir = /srv/data
size = 50
advanced_report = no

[monitor:amqp]
routing_key =
default_routing_key=
host =

[api.endpoints]
lizmap_api=/lizmap

[api.enabled]
lizmap_api=yes
```
nano /srv/qgis/config/qgis-service.env
```
LC_ALL=ja_JP.UTF-8
LANG=ja_JP.UTF-8
DISPLAY=:99
QGIS_OPTIONS_PATH=/srv/qgis/
QGIS_AUTH_DB_DIR_PATH=/srv/qgis/
GDAL_CACHEMAX=2048
QGIS_SERVER_CACHE_SIZE=2048
QGIS_SERVER_LIZMAP_REVEAL_SETTINGS=TRUE
QGIS_SERVER_FORCE_READONLY_LAYERS=TRUE
QGIS_SERVER_TRUST_LAYER_METADATA=TRUE
QGIS_SERVER_APPLICATION_NAME=qgis-server
```
nano /etc/systemd/system/qgis.service
```
[Unit]
Description=QGIS server
After=network.target

[Service]
Type=simple

ExecStart=/opt/local/py-qgis-server/bin/qgisserver -c /srv/qgis/server.conf

# FIXME it is recommended to have a script *synchronous*, which is not the case here
ExecReload=/usr/bin/qgis-reload

KillMode=control-group
KillSignal=SIGTERM
TimeoutStopSec=10

Restart=always

StandardOutput=append:/var/log/qgis/qgis-server.log
StandardError=inherit
SyslogIdentifier=qgis

EnvironmentFile=/srv/qgis/config/qgis-service.env
User=root

LimitNOFILE=4096

[Install]
WantedBy=multi-user.target
```

systemctl enable qgis
service qgis start

sudo service apache2 restart  

##### åŸºæœ¬ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯å¸¸ã«ã—ãŸæ–¹ãŒã„ã„æ„Ÿã˜ï¼  
##### [3.6â†’3.7(3.7.6â†’3.7.10)ãªã©ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®å ´åˆã¯ã“ã¡ã‚‰ã‚‚ï¼](./5-1-2.ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã€€The%20application%20is%20not%20installed.md)  
##### **[ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«(3-3.QGIS-Plugin-Managerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‚ç…§)](https://github.com/yamamoto-ryuzo/Lizmap-installation-Japanese-memo/blob/main/3.QGIS%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A.md#3-3qgis-plugin-manager%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB)**  


###  step3-ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«å¤±æ•—ã—ãŸã‚‰å ´åˆ  
sudo su
rm /var/www/html/lizmap  
ln -s /var/www/lizmap-web-client-$old_VERSION/lizmap/www/ /var/www/html/lizmap  
sudo service apache2 restart  

### step-4  
---
##### (lizmap-fcgi.confã€€ã®ä½œæˆ)  
cd lizmap
ï¼ˆç·¨é›†å†…å®¹ï¼‰  
FcgidInitialEnv SCRIPT_FILENAME /usr/lib/cgi-bin/qgis_mapserv.fcgi  
#FcgidInitialEnv QGIS_SERVER_LOG_FILE /opt/lizmap/data/qgis/qgisserver.log  
#FcgidInitialEnv QGIS_SERVER_LOG_LEVEL 0  
#FcgidInitialEnv QGIS_DEBUG 1  
#FcgidInitialEnv QGIS_AUTH_DB_DIR_PATH /opt/lizmap/data/qgis  
#FcgidInitialEnv QGIS_AUTH_PASSWORD_FILE /opt/lizmap/data/qgis/qgis-auth.db  
#ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å·¦å³ã•ãˆãªã„ä½ç½®ã¨ã—ãŸã„ãŒã„ã‚ã„ã‚ã„ã„ã“ã¨ã«ãªã‚‰ãªã„  
#FcgidInitialEnv QGIS_PLUGINPATH /var/www/lizmap-plugins  
#ä»Šå›ã¯ä»¥ä¸‹ã‚’åˆ©ç”¨  
FcgidInitialEnv QGIS_PLUGINPATH /usr/lib/qgis/plugins  
#QGISã‚µãƒ¼ãƒãƒ¼å´ã®ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹  
#FcgidInitialEnv QGIS_SERVER_LIZMAP_REVEAL_SETTINGS True  
#FcgidInitialEnv PGPASSFILE /opt/lizmap/data/qgis/.pgpass  
#FcgidInitialEnv PGSERVICEFILE /opt/lizmap/data/qgis/.pg_service.conf  
#QGISã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰åŒ–  
#ä¸¦åˆ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã•ã‚ŒãŸã¨ãã«ä½¿ç”¨ã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã€‚  
#å€¤ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚»ãƒƒã‚µ ã‚³ã‚¢ã®æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚-1  
FcgidInitialEnv QGIS_SERVER_MAX_THREADS 10  

#WMS GetMap è¦æ±‚ã®ä¸¦åˆ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¾ã™ã€‚  
#ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯() ã¯ç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚ä½¿ç”¨å¯èƒ½ãªå€¤ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚false  
#0ã¾ãŸã¯ (å¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„)false  
#1ã¾ãŸã¯ (å¤§æ–‡å­—ã¨å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„)true  
FcgidInitialEnv QGIS_SERVER_PARALLEL_RENDERING 1  

### step-5  
---
#### Apache2ã®è¨­å®šï¼ˆQGIS Server Pluginå«ã‚€ï¼‰  
ãƒ»000-default.confã€€ã®è¨­å®š  
nano /etc/apache2/sites-available/000-default.conf  

ä¸‹è¨˜ã‚’è¿½åŠ   

Include conf-available/lizmap-fcgi.conf  
Include conf-available/serve-cgi-bin.conf  

sudo systemctl restart apache2  

 ![image012](https://user-images.githubusercontent.com/86514652/174402261-b6a5f179-bbc3-4790-b402-1b85435ff2d1.png)

#### çœŸé¢ç›®ã«åŸå› ã‚’èª¿ã¹ã‚‹å¿…è¦ã®ã‚ã‚‹å ´åˆ  
#### ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°  

2022-06-21 20:36:24	223.133.253.183	[1024]	Error in main configuration on pluginsPath -- Path given in pluginsPath for the module jacl2db is ignored, since this module is unknown or deactivated	/var/www/lizmap-web-client-3.5.3/lib/jelix/core/jConfigCompiler.class.php	470
	/
array ( )
2022-06-21 20:36:24	223.133.253.183	[7]	Error in the main configuration. A plugin doesn't exist -- The coord plugin jacl2 is unknown.	/var/www/lizmap-web-client-3.5.3/lib/jelix/core/jConfigCompiler.class.php	206

â†‘ã€€ä½•ãŒãŠã‹ã—ã„ã®ã‹ã€€ï¼ã€€jelixï¼ˆjacl2dbï¼‰ãŒæ°—ã«å…¥ã‚‰ãªã„ï¼Ÿã€€ï¼ã€€PHPã€€ã‚‚æ€ªã—ã„ï¼Ÿï¼Ÿï¼Ÿ  
â†‘ã€€ãã‚Œã£ã¦ã©ã†ã„ã†æ„å‘³ã€€ï¼ã€€è¦ã™ã‚‹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã†ã¾ãã„ã£ã¦ã„ãªã„  

## 5-2.Lizmap Web Clientã®åˆæœŸè¨­å®š
http://lizmap.yamakun.net/lizmap/  
ã€€ 
  
æ¥ç¶šã€€ï¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…±ã«åˆæœŸè¨­å®šã¯ã€Œadminã€  
 
![image018](https://user-images.githubusercontent.com/86514652/174402684-72d9f4d9-20f5-4cf1-b69c-146db9400c85.png)


ç®¡ç†ã€€ï¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€€ï¼ã€€admin    è¡¨ç¤ºã€€ï¼ã€€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã€€ï¼ã€€ä¿å­˜  

â€ƒ![image019](https://user-images.githubusercontent.com/86514652/174402705-90fc60bb-b40f-4b1f-a859-f830117a8ed1.png)  

 
### 5-2-1.ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”¨é ˜åŸŸã®ä½œæˆ  

sudo su   
cd /var/www  
mkdir lizmap  
chown www-data:www-data lizmap  

### 5-2-2.ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆ  
ãƒªãƒã‚¸ãƒˆãƒªã€Œlizmapcloudã€ã®ä½œæˆä¾‹  
mkdir  lizmap/lizmapcloud  
chown lizmapcloud:www-data lizmapcloud  

![Alt text](../image/image027.png)

### 5-3.Lizmap Web Clientã®é«˜é€ŸåŒ–ï¼ˆPHPã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰åŒ–ï¼‰  
(STEPï¼‘)  
sudo su  
apt -y install php-fpm  

vi /etc/apache2/sites-available/default-ssl.conf  
#ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ãã®éƒ½åº¦ç¢ºèªã®äº‹ã€€ä»Šå›ã¯8.0ã§ã—ãŸã€‚  
#<VirtualHost> - </VirtualHost> å†…ã«è¿½è¨˜  
    <FilesMatch \.php$>  
        SetHandler "proxy:unix:/var/run/php/php8.0-fpm.sock|fcgi://localhost/"  
    </FilesMatch>  

a2enmod proxy_fcgi setenvif  
a2enconf php8.0-fpm  
systemctl restart php8.0-fpm apache2  

echo '<?php phpinfo(); ?>' > /var/www/html/lizmap/info.php  

  
https://lizmap.yamakun.net/info.php  

Server API[FPM/FastCGI] ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã° OK ã§ã™  
 
![image020](https://user-images.githubusercontent.com/86514652/174402814-5867b2f5-8e5a-463c-b38f-25fb838882e4.png)

ï¼ˆSTEP2ï¼‰  
ï½ï½ˆï½-ï½†ï½ï½ã®è¨­å®šã‚’è¡Œã†  
 ![image021](https://user-images.githubusercontent.com/86514652/174402885-9083ab6c-91d4-4709-a81d-6af770155398.png)

 
ã‚’ã¿ã‚‹ã¨ï¼Œpool.d/*.confã«è¨­å®šã—ã‚ã¨ã‚ã‚‹ï¼  

ã€€ï½—ï½—ï½—.ï½ƒï½ï½ï½†ã‚’ç¢ºèªã™ã‚‹ã¨ï¼Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šä»–ã„ã„æ„Ÿã˜ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚  
ã€€æ¨™æº–ã®ã€€pm = dynamicã€€ã¨ãªã£ã¦ã„ãŸã®ã§ï¼Œãã®ã¾ã¾ï¼Œä¸‹è¨˜ã‚’é©åˆ‡ã«è¨­å®šï¼  
pm.max_children = 814  
pm.start_servers = 8  
pm.min_spare_servers = 4  
pm.max_spare_servers = 8  
pm.max_requests = 300  
![image022](https://user-images.githubusercontent.com/86514652/174402940-3afe36f6-e6ce-4ff0-95aa-36586fdacbe5.png)


å‹•ä½œç¢ºèªã¯ã€€htopã€€ã«ãŠã„ã¦ã€€php-fpmã€€ãŒè¤‡æ•°èµ·å‹•ã—ï¼Œãã¡ã‚“ã¨å‹•ä½œã—ã¦ã„ã‚Œã°ï¼¯ï¼«ï¼  

ï¼ˆå‚è€ƒï¼‰å•é¡Œãªã®ã¯ã€€qgis_mapserv.fcgiã€€ã®ã‚ˆã†ã§ã™ã€‚  
 
  ![image023](https://user-images.githubusercontent.com/86514652/174403013-7ce10ae9-5627-4107-a257-59860b04cbec.png)

â€ƒ
### 5-4.Lizmap Web Clientã®é«˜é€ŸåŒ–ï¼ˆQGIS Serverã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰åŒ–ï¼‰  
â€»QGISã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã€€2. Apache2ã®è¨­å®šï¼ˆQGIS Server Pluginå«ã‚€ï¼‰ã«è¿½åŠ   
å†…å®¹ã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰æŒ‡å®š  

ã€€ãƒ»lizmap-fcgi.confã€€ã¸è¿½åŠ ã€€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã‚’è¿½åŠ ã®ã¿  
ã€€/etc/apache2/conf-available/lizmap-fcgi.conf   

#QGISã®ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰åŒ–  
#ä¸¦åˆ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã•ã‚ŒãŸã¨ãã«ä½¿ç”¨ã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã€‚  
#å€¤ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚»ãƒƒã‚µ ã‚³ã‚¢ã®æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
FcgidInitialEnv QGIS_SERVER_MAX_THREADS 10  
#WMS GetMap è¦æ±‚ã®ä¸¦åˆ—ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¾ã™ã€‚  
#ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯() ã¯ç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚ä½¿ç”¨å¯èƒ½ãªå€¤ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚
FcgidInitialEnv QGIS_SERVER_PARALLEL_RENDERING 1  

çµæœã¯ï¼Œä¸‹è¨˜ã®é€šã‚Šqgis_mapserv.fcgiãŒãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  
![image024](https://user-images.githubusercontent.com/86514652/174403739-0e21bc57-cb01-4a43-9dc6-ba67b62637f9.png)




## 6.Lizmap Web Clientã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º  
### 6-1.Java ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ   
### 6-2.ãƒ†ãƒ¼ãƒã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º  
éª¨æ ¼  
1.WEBç®¡ç†ç”»é¢ã‹ã‚‰ãƒ†ãƒ¼ãƒãƒ»JAVAã‚’è¨±å¯  
2.ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ†ãƒ¼ãƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰  
ã€€https://(your.lizmap.instance)/index.php/view/media/getDefaultTheme  
ã€€ã‚’å…¥åŠ›ã™ã‚‹ã¨ï¼Œè‡ªå‹•çš„ã«lizmapWebClient_default_theme.zipãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚  
3.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã™ã‚‹ã¨ä¸‹è¨˜å†…å®¹ãŒå«ã¾ã‚ŒãŸã„ã¾ã™ã€‚  
ãƒ»lizmapWebClient_default_theme.zip  
ã€€|-- default  
ã€€ã€€|-- css  
 ã€€ã€€ã€€|-- main.css  
 ã€€ã€€ã€€|-- map.css  
 ã€€ã€€ã€€|-- media.css  
 ã€€ã€€ã€€|-- img  
 ã€€ã€€ã€€ã€€|-- loading.gif  
 ã€€ã€€ã€€ã€€|-- etc  
 ã€€ã€€ã€€|-- images  
 ã€€ã€€ã€€ã€€|-- sprite_20.png  
 ã€€ã€€ã€€ã€€|-- etc  
4.defaultã®åå‰ã‚’å…¬é–‹ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨åŒã˜åå‰ï¼ˆä¾‹ï¼šmap_project_file_name1ï¼‰ã«å¤‰ãˆã¦ä¸‹è¨˜ä½ç½®ã«è¨­ç½®  
-- media  
ã€€|-- themes  
ã€€ã€€|-- default  
ã€€ã€€|-- map_project_file_name1  
ã€€ã€€|-- map_project_file_name2  
ã€€ã€€|-- etc  

### 6-3.åˆ¥ã® Web ãƒšãƒ¼ã‚¸ã« Lizmap ã‚’åŸ‹ã‚è¾¼ã‚€(iframe)  
## 7. Encryptï¼ˆSSLï¼‰å°å…¥  
ï¼ˆSSLã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰  
sudo a2enmod ssl  
sudo a2ensite default-ssl  
sudo service apache2 restart  

ï¼ˆInstall Certbot Snapï¼‰  
sudo snap install core  
sudo snap refresh core  
sudo apt -y remove certbot  

sudo apt -y install certbot python3-certbot-apache  

ï¼ˆInstall Certificates from Let's Encryptï¼‰  
sudo certbot --apache -w /var/www/html/ -d lizmap.yamakun.net 

ã„ã‚ã„ã‚èã‹ã‚Œã‚‹ã®ã§å…¥åŠ›ï¼  

èªè¨¼ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œãªã„ã‚ˆã†ã«ã‚¿ã‚¤ãƒãƒ¼è¨­å®š  
sudo systemctl status certbot.timer  
sudo systemctl list-timers certbot.timer --no-pager  

å‚è€ƒã¾ã§ã«æ‰‹å‹•ã§ã®æ›´æ–°ã¯  
sudo certbot renew  
## 8.QGISã§ã®è¨­å®šä¸Šã®æ³¨æ„äº‹é …
### åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ã®ç½®ãå ´æ‰€ãŒæ±ºã¾ã£ã¦ã„ã‚‹ï¼
[è©³ç´°ã¯ã“ã¡ã‚‰](https://docs.lizmap.com/current/ja/publish/quick_start/index.html#preparing-your-file-organization)

![image](https://github.com/user-attachments/assets/28b74382-0fb2-4423-9b3c-89f7431772e4)
